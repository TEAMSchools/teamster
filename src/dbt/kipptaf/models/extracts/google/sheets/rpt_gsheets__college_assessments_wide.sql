with
    tests_long as (
        select
            region,
            school,
            student_number,
            salesforce_id,
            student_name,
            student_first_name,
            student_last_name,
            grade_level,
            student_email,
            ktc_cohort,
            enroll_status,
            graduation_year,
            year_in_network,
            iep_status,
            grad_iep_exempt_status_overall,
            cumulative_y1_gpa,
            cumulative_y1_gpa_projected,
            college_match_gpa,
            college_match_gpa_bands,
            ccr_course,
            ccr_teacher_name,
            ccr_section,
            sat_total_superscore,
            sat_ebrw_highest,
            sat_math_highest,
            test_type,
            test_date,
            test_subject,
            scale_score,
        from {{ ref("rpt_gsheets__college_assessments_long") }}
        where test_type != 'ACT'
    )

select
    region,
    school,
    student_number,
    salesforce_id,
    student_name,
    student_first_name,
    student_last_name,
    grade_level,
    student_email,
    ktc_cohort,
    enroll_status,
    graduation_year,
    year_in_network,
    iep_status,
    grad_iep_exempt_status_overall,
    cumulative_y1_gpa,
    cumulative_y1_gpa_projected,
    college_match_gpa,
    college_match_gpa_bands,
    ccr_course,
    ccr_teacher_name,
    ccr_section,
    sat_total_superscore,
    sat_ebrw_highest,
    sat_math_highest,
    test_type,
    test_date,
    ebrw,
    math,
    combined,
from
    tests_long
    pivot (max(scale_score) for lower(test_subject) in ('EBRW', 'Math', 'Combined'))
where enroll_status = 'Currently Enrolled'
