semantic_models:
  - name: teammates
    model: ref('dim_teammates')
    description:
      Staff roster dimension with job titles, departments, demographics, and
      employment status. Includes key fields for HR reporting and workforce
      tracking.
    primary_entity: teammate_event_key

    defaults:
      agg_time_dimension: effective_date_start

    entities:
      - name: employee_number
        type: natural
        expr: employee_number

    dimensions:
      - name: formatted_name
        type: categorical
        description: The employee's preferred name, in "Last, First" format

      - name: assignment_status
        type: categorical
        description: '{{doc("teammates_assignment_status")}}'

      - name: race_ethnicity_reporting
        type: categorical
        description: '{{doc("teammates_race_ethnicity_reporting")}}'

      - name: home_business_unit_name
        type: categorical
        description: '{{doc("teammates_home_business_unit_name")}}'

      - name: home_work_location_name
        type: categorical
        description: '{{doc("teammates_home_work_location_name")}}'

      - name: home_work_location_powerschool_school_id
        type: categorical
        description: The PowerSchool ID number of the home work location
        # to do: add as foreign key when dim_schools is ready

      - name: home_work_location_grade_band
        type: categorical
        description: '{{doc("teammates_home_work_location_grade_band")}}'

      - name: home_department_name
        type: categorical
        description: '{{doc("teammates_home_department_name")}}'

      - name: job_title
        type: categorical
        description: '{{doc("teammates_job_title")}}'

      - name: reports_to_formatted_name
        type: categorical
        description: '{{doc("teammates_reports_to_formatted_name")}}'

      - name: is_teacher
        type: categorical
        description: '{{doc("teammates_is_teacher")}}'

      - name: grade_taught
        type: categorical
        description: Grade taught based on number of students in PowerSchool

      - name: current_roster
        type: categorical
        description: The record is the current (latest) record for that employee (one row per number)

      - name: primary_indicator
        type: categorical

      - name: is_current_record
        type: categorical

      - name: effective_date_start
        type: time
        expr: effective_date_start
        description: start date of a unique row in the roster history
        type_params:
          time_granularity: day
          validity_params:
            is_start: True

      - name: effective_date_end
        type: time
        expr: effective_date_end
        description: end date of a unique row in the roster history
        type_params:
          time_granularity: day
          validity_params:
            is_end: True

  - name: headcount
    model: ref('fct_teammates__headcount')
    description: A fact model representing employee hire and termination events for headcount analysis.
    primary_entity: headcount_event_key

    defaults:
      # The primary time dimension is the single event_date
      agg_time_dimension: event_date

    entities:
      # This joins to your teammates dimension
      - name: employee_number
        type: foreign

    dimensions:
      - name: event_date
        type: time
        type_params:
          time_granularity: day

    measures:
      # This measure represents the raw +1 or -1 values
      - name: net_change_in_headcount
        description: The net change in the number of employees on a given day.
        agg: sum
        expr: headcount_value

metrics:
  # This is the final, queryable metric that provides the point-in-time count
  - name: point_in_time_headcount
    description: Total number of active employees on any given day.
    type: cumulative
    label: Point-in-Time Headcount
    type_params:
      # It calculates the running sum of our measure
      measure:
        name: net_change_in_headcount
        join_to_timespine: True
